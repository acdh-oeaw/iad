{% extends "webpage/base.html" %}
{% load staticfiles %}
{% load stats_extras %}
{% load webpage_extras %}
{% load leaflet_tags %}
{% block scriptHeader %}
    {% leaflet_js %}
    {% leaflet_css %}
{% endblock %}
{% block content %}
<div class="jumbotron" style="padding:0;">

    {% leaflet_map "yourmap" callback="window.map_init_basic" %}%}

</div>
<div class="container">
    <h1 style="text-align:center; color: #111;">{% projects_metadata 'title' %}</h1>
        <div class="row" style="padding:10px;">

            <div class="col-md-6">
                <div class="card site-page">
                    <div class="card-body">
                        <h5 class="card-title">Sites</h5>
                        <p class="card-text">Provide some short text.</p>
                        <a href="{% url 'browsing:browse_sites' %}" class="btn btn-outline-secondary" style="color:white; border-color:white;">browse</a>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card archent-page">
                    <div class="card-body">
                        <h5 class="card-title">Archaelogical Entities</h5>
                        <p class="card-text">Provide some short text.</p>
                        <a href="{% url 'browsing:browse_archents' %}" class="btn btn-outline-secondary" style="color:white; border-color:white;">browse</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="padding:10px;">
            <div class="col-md-6">
                <div class="card researchevent-page">
                    <div class="card-body">
                        <h5 class="card-title">Research Activities</h5>
                        <p class="card-text">Provide some short text.</p>
                        <a href="{% url 'browsing:browse_researchevents' %}" class="btn btn-outline-secondary" style="color:white; border-color:white;">browse</a>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card monumentprotection-page">
                    <div class="card-body">
                        <h5 class="card-title">Monument Protection</h5>
                        <p class="card-text">Provide some short text.</p>
                        <a href="{% url 'browsing:browse_monumentprotections' %}" class="btn btn-outline-secondary" style="color:white; border-color:white;">browse</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">
                    {% projects_metadata 'subtitle' %}
                </h5>
                <p class="card-text">
                    {% projects_metadata 'description' %}
                </p>
            </div>
        </div>


</div>
<script>
    function createLink(propertyObject) {
        var model_name = "{{ self_model_name }}"
        var url = "/archiv/site/detail/" + propertyObject.pk;
        var link = '<a href="' + url + '">' + propertyObject.name + '</a>';
        return link
    }
    function onEachFeature(feature, layer) {
        // if (feature.properties && feature.properties.name) {
        var popupContent = createLink(feature.properties);
        layer.bindPopup(popupContent);
        // }
    }
    var SiteStyle = {
        "color": "#F18C8E",
        "weight": 1,
        "opacity": 1,
        "fillOpacity": 0.5,
    };

    var ArchentStyle = {
        "color": "#F0B7A4",
        "weight": 1,
        "opacity": 1,
        "fillOpacity": 1,
    };
    function map_init_basic (map, options) {

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.light',
            accessToken: 'pk.eyJ1Ijoic2VubmllcmVyIiwiYSI6ImNpbHk1YWV0bDAwZnB2dW01d2l1Y3phdmkifQ.OljQLEhqeAygai2y6VoSwQ'
        }).addTo(map);

        var SiteShapeLayer = L.geoJson({{shapes|safe }}, {
            onEachFeature: onEachFeature
        }).setStyle(SiteStyle);
        SiteShapeLayer.addTo(map);
        map.layerscontrol.addOverlay(SiteShapeLayer, 'Sites (Shapes)');
        map.fitBounds(SiteShapeLayer.getBounds());

        var SitePointLayer = L.geoJson({{points|safe }}, {
            onEachFeature: onEachFeature
        });
        map.layerscontrol.addOverlay(SitePointLayer, 'Sites (Points)');
        map.fitBounds(SitePointLayer.getBounds());

        var ArchentShapeLayer = L.geoJson({{shapes_archent|safe }}, {}).setStyle(ArchentStyle);
        ArchentShapeLayer.addTo(map);
        map.layerscontrol.addOverlay(ArchentShapeLayer, 'Archents (Shapes)');
        map.fitBounds(ArchentShapeLayer.getBounds());
    }
</script>
{% endblock %}
